---
layout: default
title: –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–Ω–ª–∞–π–Ω ‚Äî SEO –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
description: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Å–º—ã—Å–ª—É –¥–ª—è SEO. –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ, –æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ –∏–Ω—Ç–µ–Ω—Ç—ã, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ CSV/Excel/JSON. –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
---
    <style>
        .container-flex {
            display: flex;
            gap: 30px;
        }

        .container-flex button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 15px;
        }
        .container-flex button:hover {
            background-color: #2980b9;
        }
        .main-content {
            flex: 3;
        }
        .sidebar {
            flex: 1;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .cluster {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        .cluster-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .cluster-title {
            font-weight: bold;
            font-size: 18px;
            color: #2c3e50;
        }
        .query-item {
            background-color: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 3px;
            border-left: 3px solid #3498db;
            display: flex;
            justify-content: space-between;
        }
        .query-actions {
            opacity: 0;
            transition: opacity 0.2s;
        }
        .query-item:hover .query-actions {
            opacity: 1;
        }
        .query-actions button {
            padding: 2px 5px;
            font-size: 12px;
            margin-left: 5px;
            background-color: #95a5a6;
        }
        .query-actions button:hover {
            background-color: #7f8c8d;
        }
        .stats {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .tab {
            display: none;
        }
        .tab.active {
            display: block;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
			background: none;
        }
        .drag-handle {
            cursor: move;
            margin-right: 10px;
            color: #95a5a6;
        }
        .settings-panel {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .settings-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .cluster-placeholder {
            border: 2px dashed #ccc;
            background-color: #fafafa;
            min-height: 50px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .dragging {
            opacity: 0.5;
            background-color: #e3f2fd;
        }
        .cluster-number {
            display: inline-block;
            width: 25px;
            height: 25px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 25px;
            margin-right: 10px;
            font-size: 14px;
        }
        .cluster.dragging-cluster {
            opacity: 0.5;
            border: 2px dashed #3498db;
        }
        .cluster-placeholder-cluster {
            border: 2px dashed #3498db;
            background-color: #e3f2fd;
            height: 60px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

.cluster-controls button {
    margin-right: 10px;
    margin-bottom: 10px;
}

@media (max-width: 768px) {
.container-flex{display:block}
}

    </style>

    <div class="news-article">
<header class="converter-header">
            <h1 class="converter-title">SEO Query Clusterizer - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</h1>
            <p class="converter-description">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∏–Ω—Ç–µ–Ω—Ç—É —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä—É—á–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏</p>
        </header>
<div class="converter-card article-content container">
       <div class="container-flex"> 
		<div class="main-content">
<div class="tabs">
    <button class="tab-button active" data-tab="input-tab">–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö</button>
    <button class="tab-button" data-tab="clusters-tab">–ö–ª–∞—Å—Ç–µ—Ä—ã</button>
    <button class="tab-button" data-tab="export-tab">–≠–∫—Å–ø–æ—Ä—Ç</button>
</div>

            <div id="input-tab" class="tab active">
                <h2>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–∏ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h2>
                <p>–í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É) –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ CSV/Excel —Ñ–∞–π–ª</p>
                
                <textarea id="queries-input" placeholder="–∫—É–ø–∏—Ç—å iPhone 15
—Ä–µ–º–æ–Ω—Ç iPhone –≤ –ú–æ—Å–∫–≤–µ
—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç iPhone 15
—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ iPhone 15
–∑–∞–º–µ–Ω–∞ —ç–∫—Ä–∞–Ω–∞ iPhone
—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ iPhone 15 –∏ Samsung S23"></textarea>
                
                <div>
                    <button onclick="processQueries()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é</button>
                    <button onclick="loadSampleData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä</button>
                    <button onclick="clearInput()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>

                <div class="settings-panel">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏</h3>
                    <div class="settings-group">
                        <label for="algorithm">–ê–ª–≥–æ—Ä–∏—Ç–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:</label>
                        <select id="algorithm">
                            <option value="keywords">–ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</option>
                            <option value="semantic">–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)</option>
                            <option value="improved">–£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label for="sensitivity">–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</label>
                        <input type="range" id="sensitivity" min="1" max="10" value="5">
                        <span id="sensitivity-value">5</span>
                    </div>
                    <div class="settings-group">
                        <label><input type="checkbox" id="use-stemming" checked> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–µ–º–º–∏–Ω–≥ (–æ—Å–Ω–æ–≤—ã —Å–ª–æ–≤)</label>
                    </div>
                    <div class="settings-group">
                        <label><input type="checkbox" id="remove-stopwords" checked> –£–¥–∞–ª—è—Ç—å —Å—Ç–æ–ø-—Å–ª–æ–≤–∞</label>
                    </div>
                </div>
            </div>

            <div id="clusters-tab" class="tab">
                <div class="stats" id="cluster-stats">
                    <p>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–≤: <strong id="total-queries">0</strong> | –°–æ–∑–¥–∞–Ω–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤: <strong id="total-clusters">0</strong></p>
                </div>

                <div class="cluster-controls">
                    <button onclick="addNewCluster()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä</button>
                    <button onclick="mergeSelectedClusters()">–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
                    <button onclick="splitCluster()">–†–∞–∑–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä</button>
                    <button onclick="recluster()">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é</button>
					<button onclick="moveByKeywords()">–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º</button>
                </div>

                <div id="clusters-container">
                    <!-- –ö–ª–∞—Å—Ç–µ—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div class="cluster-placeholder" id="cluster-placeholder" style="display: none;">
                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã —Å—é–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
                </div>
                <div class="cluster-placeholder-cluster" id="cluster-placeholder-cluster" style="display: none;">
                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä —Å—é–¥–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
                </div>
            </div>

            <div id="export-tab" class="tab">
                <h2>–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤–∞—à–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:</p>
                
                <div>
                    <button onclick="exportTo('csv')">CSV</button>
                    <button onclick="exportTo('json')">JSON</button>
                    <button onclick="exportTo('excel')">Excel</button>
                </div>
                
                <div class="settings-panel" style="margin-top: 20px;">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>
                    <div class="settings-group">
                        <label><input type="checkbox" id="export-names" checked> –í–∫–ª—é—á–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤</label>
                    </div>
                    <div class="settings-group">
                        <label><input type="checkbox" id="export-stats" checked> –í–∫–ª—é—á–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º</label>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>
                    <textarea id="export-preview" style="min-height: 200px;" readonly></textarea>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
            <div id="operations-history" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 200px; max-height: 300px; overflow-y: auto;">
                <p><small>–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</small></p>
            </div>

            <h3 style="margin-top: 30px;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <button style="width: 100%; margin-bottom: 10px;" onclick="undoLastAction()">–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ</button>
            <button style="width: 100%; margin-bottom: 10px;" onclick="saveProject()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            <button style="width: 100%; margin-bottom: 10px;" onclick="loadProject()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
        </div>
    </div></div>
<div class="converter-info">
    <div class="converter-info__content">
<p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br />SEO Query Clusterizer ‚Äî —ç—Ç–æ —É–¥–æ–±–Ω—ã–π –æ–Ω–ª–∞–π–Ω-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Å–º—ã—Å–ª–æ–≤—ã–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç SEO-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º, –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∞–º –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞–º —Å–∞–π—Ç–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ, –≤—ã–¥–µ–ª—è—è –≥—Ä—É–ø–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–±—â–∏–º –∏–Ω—Ç–µ–Ω—Ç–æ–º.</p><h2>üìå –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤?</h2><p>–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:<br />‚úî¬†<strong>–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–∞–º</strong>¬†‚Äî —É–ø—Ä–æ—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞.<br />‚úî¬†<strong>–í—ã—è–≤–ª—è—Ç—å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–Ω—Ç—ã</strong>¬†‚Äî –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã.<br />‚úî¬†<strong>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–∞–π—Ç–∞</strong>¬†‚Äî –æ–¥–∏–Ω –∫–ª–∞—Å—Ç–µ—Ä = –æ–¥–Ω–∞ –ø–æ—Å–∞–¥–æ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞.<br />‚úî¬†<strong>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä—É—Ç–∏–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É</strong>¬†‚Äî –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã.</p><h2>üìã –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º?</h2><p><strong>1. –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤</strong></p><ul><li>–í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫—É) –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞.</li><li>–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ¬†<strong>CSV/Excel</strong>.</li><li>–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†<strong>–ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤</strong>¬†–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</li></ul><p><strong>2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏</strong></p><ul><li><strong>–ê–ª–≥–æ—Ä–∏—Ç–º</strong>:<ul><li><strong>–ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</strong>¬†(–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–±—â–∏–º —Å–ª–æ–≤–∞–º).</li><li><strong>–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</strong>¬†(—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Ç–∞).</li><li><strong>–£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º</strong>¬†(—É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã –∏ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞).</li></ul></li><li><strong>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</strong>¬†(—Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç "—Å—Ç—Ä–æ–≥–æ—Å—Ç—å" –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏).</li><li><strong>–û–ø—Ü–∏–∏</strong>:<ul><li>‚úÖ –°—Ç–µ–º–º–∏–Ω–≥ (–ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Å–ª–æ–≤ –∫ –æ—Å–Ω–æ–≤–µ).</li><li>‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–æ–ø-—Å–ª–æ–≤ (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ "–º—É—Å–æ—Ä–Ω—ã—Ö" —Å–ª–æ–≤).</li></ul></li></ul><p><strong>3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤</strong></p><p>–ü–æ—Å–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤—ã –º–æ–∂–µ—Ç–µ:<br />‚úè¬†<strong>–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä</strong>¬†(–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "‚úèÔ∏è").<br />üóë¬†<strong>–£–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä</strong>¬†(–µ—Å–ª–∏ –æ–Ω –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–µ–Ω).<br />‚û°¬†<strong>–ü–µ—Ä–µ–º–µ—â–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã</strong>¬†–º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ (drag &amp; drop).<br />‚ûï¬†<strong>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä</strong>¬†–≤—Ä—É—á–Ω—É—é.<br />üîÄ¬†<strong>–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å</strong>¬†—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã.</p><p><strong>4. –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</strong></p><p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã:</p><ul><li><strong>CSV</strong>¬†(—É–¥–æ–±–Ω–æ –¥–ª—è —Ç–∞–±–ª–∏—Ü).</li><li><strong>Excel</strong>¬†(–∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ª–∏—Å—Ç–µ).</li><li><strong>JSON</strong>¬†(–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ API).</li></ul><h2>üîé –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2><p><strong>‚ùì –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ SEO?</strong></p><p>–û–Ω–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–µ–π –∏ –ø–æ–≤—ã—à–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å.</p><p><strong>‚ùì –ö–∞–∫–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –ª—É—á—à–µ?</strong></p><ul><li>–î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî¬†<strong>"–ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤"</strong>.</li><li>–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ ‚Äî¬†<strong>"–£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º"</strong>¬†(—É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç).</li></ul><p><strong>‚ùì –ú–æ–∂–Ω–æ –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä—ã –≤—Ä—É—á–Ω—É—é?</strong></p><p>–î–∞! –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç¬†<strong>–¥–æ–±–∞–≤–ª—è—Ç—å, —É–¥–∞–ª—è—Ç—å –∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å</strong>¬†–∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏.</p><p><strong>üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ SEO Query Clusterizer –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî —ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!</strong><br />–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ –∑–∞ –º–∏–Ω—É—Ç—ã, –∞ –Ω–µ —á–∞—Å—ã. üöÄ</p>
</div></div>
	</div>


<script>
// –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä—É—Å—Å–∫–∏–π —Å—Ç–µ–º–º–µ—Ä (–∞–Ω–∞–ª–æ–≥ Natural.PorterStemmerRu)
class RussianStemmer {
  static stemWord(word) {
    if (!word || word.length < 3) return word;

    // –£–¥–∞–ª—è–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º)
    const endings = [
      '–æ–≤', '–µ–≤', '—ë–≤', '–∏–Ω', '—ã–Ω', '—ã—Ö', '–∏—Ö', '–æ–≥–æ', '–µ–≥–æ', '–æ–º—É', '–µ–º—É',
      '—ã–º–∏', '–∏–º–∏', '–æ–π', '–µ–π', '–∏–π', '—ã–π', '–∞—è', '—è—è', '–æ–µ', '–µ–µ', '—ã–µ', '–∏–µ',
      '—Ç—å', '—Ç–∏', '–µ–π', '–æ–π', '–∞–º', '—è–º', '–µ–º', '–∏–º', '—É–º', '–æ–º', '–∞—Ö', '—è—Ö',
      '–º–∏', '–ª–∏', '–∏', '—ã', '–∞', '—è', '–æ', '–µ', '—É', '—é', '—å', '–π'
    ];

    for (const ending of endings) {
      if (word.endsWith(ending)) {
        return word.slice(0, -ending.length);
      }
    }

    return word;
  }
}

// –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ (–∞–Ω–∞–ª–æ–≥ natural.PorterStemmerRu)
window.RussianStemmer = RussianStemmer;
</script>
    <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const state = {
        queries: [],
        clusters: [],
        history: [],
        currentHistoryIndex: -1
    };

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const elements = {
        queriesInput: document.getElementById('queries-input'),
        clustersContainer: document.getElementById('clusters-container'),
        clusterPlaceholder: document.getElementById('cluster-placeholder'),
        clusterPlaceholderCluster: document.getElementById('cluster-placeholder-cluster'),
        totalQueries: document.getElementById('total-queries'),
        totalClusters: document.getElementById('total-clusters'),
        operationsHistory: document.getElementById('operations-history'),
        exportPreview: document.getElementById('export-preview'),
        sensitivity: document.getElementById('sensitivity'),
        sensitivityValue: document.getElementById('sensitivity-value'),
        algorithm: document.getElementById('algorithm'),
        useStemming: document.getElementById('use-stemming'),
        removeStopwords: document.getElementById('remove-stopwords')
    };

    // –°–∏–Ω–æ–Ω–∏–º—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
    const synonyms = {
        '–∫—É–ø–∏—Ç—å': ['–ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏', '–∑–∞–∫–∞–∑–∞—Ç—å', '–ø–æ–∫—É–ø–∫–∞', '–∫—É–ø–∏—Ç—å', '–ø—Ä–æ–¥–∞–∂–∞'],
        '—Ä–µ–º–æ–Ω—Ç': ['–ø–æ—á–∏–Ω–∫–∞', '–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', '—á–∏–Ω–∏—Ç—å', '—Ä–µ–º–æ–Ω—Ç', '—Å–µ—Ä–≤–∏—Å'],
        '—Ü–µ–Ω–∞': ['—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Ü–µ–Ω–Ω–∏–∫', '—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç', '–ø—Ä–∞–π—Å', '—Ü–µ–Ω–∞'],
        '—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏': ['–æ–ø–∏—Å–∞–Ω–∏–µ', '–ø–∞—Ä–∞–º–µ—Ç—Ä—ã', 'specs', '—Ñ—É–Ω–∫—Ü–∏–∏', '—Å–≤–æ–π—Å—Ç–≤–∞'],
        '—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ': ['–æ—Ç–ª–∏—á–∏–µ', 'vs', 'versus', '–∏–ª–∏', '—á—Ç–æ –ª—É—á—à–µ', '—Ä–∞–∑–Ω–∏—Ü–∞']
    };

    // –†—É—Å—Å–∫–∏–µ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
    const russianStopwords = [
        '–∏', '–≤', '–≤–æ', '–Ω–µ', '—á—Ç–æ', '–æ–Ω', '–Ω–∞', '—è', '—Å', '—Å–æ', '–∫–∞–∫', '–∞', '—Ç–æ', '–≤—Å–µ', '–æ–Ω–∞', '—Ç–∞–∫', '–µ–≥–æ', 
        '–Ω–æ', '–¥–∞', '—Ç—ã', '–∫', '—É', '–∂–µ', '–≤—ã', '–∑–∞', '–±—ã', '–ø–æ', '—Ç–æ–ª—å–∫–æ', '–µ–µ', '–º–Ω–µ', '–±—ã–ª–æ', '–≤–æ—Ç', '–æ—Ç', 
        '–º–µ–Ω—è', '–µ—â–µ', '–Ω–µ—Ç', '–æ', '–∏–∑', '–µ–º—É', '—Ç–µ–ø–µ—Ä—å', '–∫–æ–≥–¥–∞', '–¥–∞–∂–µ', '–Ω—É', '–≤–¥—Ä—É–≥', '–ª–∏', '–µ—Å–ª–∏', '—É–∂–µ', 
        '–∏–ª–∏', '–Ω–∏', '–±—ã—Ç—å', '–±—ã–ª', '–Ω–µ–≥–æ', '–¥–æ', '–≤–∞—Å', '–Ω–∏–±—É–¥—å', '–æ–ø—è—Ç—å', '—É–∂', '–≤–∞–º', '–≤–µ–¥—å', '—Ç–∞–º', '–ø–æ—Ç–æ–º', 
        '—Å–µ–±—è', '–Ω–∏—á–µ–≥–æ', '–µ–π', '–º–æ–∂–µ—Ç', '–æ–Ω–∏', '—Ç—É—Ç', '–≥–¥–µ', '–µ—Å—Ç—å', '–Ω–∞–¥–æ', '–Ω–µ–π', '–¥–ª—è', '–º—ã', '—Ç–µ–±—è', '–∏—Ö', 
        '—á–µ–º', '–±—ã–ª–∞', '—Å–∞–º', '—á—Ç–æ–±', '–±–µ–∑', '–±—É–¥—Ç–æ', '—á–µ–≥–æ', '—Ä–∞–∑', '—Ç–æ–∂–µ', '—Å–µ–±–µ', '–ø–æ–¥', '–±—É–¥–µ—Ç', '–∂', '—Ç–æ–≥–¥–∞', 
        '–∫—Ç–æ', '—ç—Ç–æ—Ç', '—Ç–æ–≥–æ', '–ø–æ—Ç–æ–º—É', '—ç—Ç–æ–≥–æ', '–∫–∞–∫–æ–π', '—Å–æ–≤—Å–µ–º', '–Ω–∏–º', '–∑–¥–µ—Å—å', '—ç—Ç–æ–º', '–æ–¥–∏–Ω', '–ø–æ—á—Ç–∏', '–º–æ–π', 
        '—Ç–µ–º', '—á—Ç–æ–±—ã', '–Ω–µ–µ', '—Å–µ–π—á–∞—Å', '–±—ã–ª–∏', '–∫—É–¥–∞', '–∑–∞—á–µ–º', '–≤—Å–µ—Ö', '–Ω–∏–∫–æ–≥–¥–∞', '–º–æ–∂–Ω–æ', '–ø—Ä–∏', '–Ω–∞–∫–æ–Ω–µ—Ü', '–¥–≤–∞', 
        '–æ–±', '–¥—Ä—É–≥–æ–π', '—Ö–æ—Ç—å', '–ø–æ—Å–ª–µ', '–Ω–∞–¥', '–±–æ–ª—å—à–µ', '—Ç–æ—Ç', '—á–µ—Ä–µ–∑', '—ç—Ç–∏', '–Ω–∞—Å', '–ø—Ä–æ', '–≤—Å–µ–≥–æ', '–Ω–∏—Ö', '–∫–∞–∫–∞—è', 
        '–º–Ω–æ–≥–æ', '—Ä–∞–∑–≤–µ', '—Ç—Ä–∏', '—ç—Ç—É', '–º–æ—è', '–≤–ø—Ä–æ—á–µ–º', '—Ö–æ—Ä–æ—à–æ', '—Å–≤–æ—é', '—ç—Ç–æ–π', '–ø–µ—Ä–µ–¥', '–∏–Ω–æ–≥–¥–∞', '–ª—É—á—à–µ', '—á—É—Ç—å', 
        '—Ç–æ–º', '–Ω–µ–ª—å–∑—è', '—Ç–∞–∫–æ–π', '–∏–º', '–±–æ–ª–µ–µ', '–≤—Å–µ–≥–¥–∞', '–∫–æ–Ω–µ—á–Ω–æ', '–≤—Å—é', '–º–µ–∂–¥—É', '—ç—Ç–æ', '–∫—Ä–æ–º–µ'
    ];

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function init() {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        elements.sensitivity.addEventListener('input', function() {
            elements.sensitivityValue.textContent = this.value;
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è drag and drop
        initDragAndDrop();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                openTab(tabId);
            });
        });
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –≤–∫–ª–∞–¥–∫–∏
    function openTab(tabId) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
        const tabs = document.getElementsByClassName('tab');
        for (let i = 0; i < tabs.length; i++) {
            tabs[i].classList.remove('active');
        }
        
        // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫
        const tabButtons = document.getElementsByClassName('tab-button');
        for (let i = 0; i < tabButtons.length; i++) {
            tabButtons[i].classList.remove('active');
        }
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –∫–Ω–æ–ø–∫—É
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // ====================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ======================

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    function processQueries() {
        const inputText = elements.queriesInput.value.trim();
        if (!inputText) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
            return;
        }

        // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        state.queries = inputText.split('\n')
            .map(q => q.trim())
            .filter(q => q.length > 0);

        // –°–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
        const algorithm = elements.algorithm.value;
        const sensitivity = parseInt(elements.sensitivity.value);
        const useStemming = elements.useStemming.checked;
        const removeStopwords = elements.removeStopwords.checked;

        if (algorithm === 'keywords') {
            clusterByKeywords(state.queries, sensitivity, useStemming, removeStopwords);
        } else if (algorithm === 'semantic') {
            clusterBySemantic(state.queries, sensitivity, useStemming, removeStopwords);
        } else {
            improvedClustering(state.queries, sensitivity, useStemming, removeStopwords);
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        renderClusters();
        openTab('clusters-tab');
        addHistory('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
    }

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
    function improvedClustering(queries, sensitivity, useStemming, removeStopwords) {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã: —É–¥–∞–ª—è–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–µ–º–º–∏–Ω–≥
        const processedQueries = queries.map(query => {
            let words = query.toLowerCase().split(/\s+/);
            
            if (removeStopwords) {
                words = words.filter(word => !russianStopwords.includes(word));
            }
            
            if (useStemming) {
                words = words.map(word => RussianStemmer.stemWord(word));
            }
            
            return words.join(' ');
        });

        // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É —Å—Ö–æ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å —É—á–µ—Ç–æ–º —Å–∏–Ω–æ–Ω–∏–º–æ–≤
        const similarityMatrix = [];
        for (let i = 0; i < queries.length; i++) {
            similarityMatrix[i] = [];
            for (let j = 0; j < queries.length; j++) {
                if (i === j) {
                    similarityMatrix[i][j] = 1;
                    continue;
                }

                // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ö–æ–¥—Å—Ç–≤–æ —Å —É—á–µ—Ç–æ–º —Å–∏–Ω–æ–Ω–∏–º–æ–≤
                similarityMatrix[i][j] = calculateSimilarity(
                    processedQueries[i], 
                    processedQueries[j], 
                    queries[i], 
                    queries[j]
                );
            }
        }

        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–¥—Å—Ç–≤–∞
        const threshold = sensitivity / 10;
        const clusters = [];
        const assigned = new Set();

        for (let i = 0; i < queries.length; i++) {
            if (assigned.has(i)) continue;

            const cluster = [i];
            assigned.add(i);

            for (let j = i + 1; j < queries.length; j++) {
                if (!assigned.has(j) && similarityMatrix[i][j] >= threshold) {
                    cluster.push(j);
                    assigned.add(j);
                }
            }

            clusters.push(cluster);
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∞—Å—Ç–µ—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        state.clusters = clusters.map(clusterIndices => ({
            name: generateClusterName(clusterIndices.map(i => queries[i])),
            queries: clusterIndices.map(i => ({
                text: queries[i],
                originalIndex: i
            }))
        }));

        updateStats();
    }

    // –†–∞—Å—á–µ—Ç —Å—Ö–æ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å —É—á–µ—Ç–æ–º —Å–∏–Ω–æ–Ω–∏–º–æ–≤
    function calculateSimilarity(processedQuery1, processedQuery2, originalQuery1, originalQuery2) {
        // –ü—Ä–æ—Å—Ç–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ª–æ–≤
        const words1 = processedQuery1.split(/\s+/);
        const words2 = processedQuery2.split(/\s+/);
        
        const set1 = new Set(words1);
        const set2 = new Set(words2);
        let common = 0;
        
        set1.forEach(word => {
            if (set2.has(word)) {
                common++;
            } else {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω–æ–Ω–∏–º—ã
                for (const [base, syns] of Object.entries(synonyms)) {
                    if ((word === base || syns.includes(word)) && 
                        (set2.has(base) || syns.some(s => set2.has(s)))) {
                        common += 0.8; // –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∑–∞ —Å–∏–Ω–æ–Ω–∏–º—ã
                        break;
                    }
                }
            }
        });

        const union = new Set([...words1, ...words2]).size;
        let similarity = union > 0 ? common / union : 0;

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —Å—Ö–æ–¥—Å—Ç–≤–∞
        const sameBrand = hasSameBrand(originalQuery1, originalQuery2);
        if (sameBrand) similarity += 0.2;
        
        const sameAction = hasSameAction(originalQuery1, originalQuery2);
        if (sameAction) similarity += 0.1;

        return Math.min(similarity, 1); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 1
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –±—Ä–µ–Ω–¥/—Ç–æ–≤–∞—Ä
    function hasSameBrand(query1, query2) {
        const brands = ['iphone', 'samsung', 'xiaomi', 'apple', 'huawei'];
        const brand1 = brands.find(b => query1.toLowerCase().includes(b));
        const brand2 = brands.find(b => query2.toLowerCase().includes(b));
        return brand1 && brand2 && brand1 === brand2;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    function hasSameAction(query1, query2) {
        const actions = {
            'buy': ['–∫—É–ø–∏—Ç—å', '–ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏', '–∑–∞–∫–∞–∑–∞—Ç—å', '—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å'],
            'repair': ['—Ä–µ–º–æ–Ω—Ç', '–ø–æ—á–∏–Ω–∫–∞', '–∑–∞–º–µ–Ω–∞', '—Å–µ—Ä–≤–∏—Å'],
            'info': ['—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏', '–æ–ø–∏—Å–∞–Ω–∏–µ', '–ø–∞—Ä–∞–º–µ—Ç—Ä—ã', '–æ–±–∑–æ—Ä', '–æ—Ç–∑—ã–≤—ã'],
            'compare': ['—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ', 'vs', 'versus', '–∏–ª–∏', '—á—Ç–æ –ª—É—á—à–µ']
        };
        
        const action1 = Object.entries(actions).find(([_, words]) => 
            words.some(w => query1.toLowerCase().includes(w)));
        const action2 = Object.entries(actions).find(([_, words]) => 
            words.some(w => query2.toLowerCase().includes(w)));
            
        return action1 && action2 && action1[0] === action2[0];
    }

    // –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    function clusterByKeywords(queries, sensitivity, useStemming, removeStopwords) {
        // –°–Ω–∞—á–∞–ª–∞ –∏–∑–≤–ª–µ–∫–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        const queryKeywords = queries.map(query => {
            let words = query.toLowerCase().split(/\s+/);
            
            if (removeStopwords) {
                words = words.filter(word => !russianStopwords.includes(word));
            }
            
            return useStemming ? words.map(stemWord) : words;
        });

        // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É —Å—Ö–æ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
        const similarityMatrix = [];
        for (let i = 0; i < queries.length; i++) {
            similarityMatrix[i] = [];
            for (let j = 0; j < queries.length; j++) {
                if (i === j) {
                    similarityMatrix[i][j] = 1;
                    continue;
                }

                // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ö–æ–¥—Å—Ç–≤–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–±—â–∏—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                const set1 = new Set(queryKeywords[i]);
                const set2 = new Set(queryKeywords[j]);
                let common = 0;
                
                set1.forEach(word => {
                    if (set2.has(word)) common++;
                });

                const union = new Set([...set1, ...set2]).size;
                similarityMatrix[i][j] = union > 0 ? common / union : 0;
            }
        }

        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–¥—Å—Ç–≤–∞
        const threshold = sensitivity / 10;
        const clusters = [];
        const assigned = new Set();

        for (let i = 0; i < queries.length; i++) {
            if (assigned.has(i)) continue;

            const cluster = [i];
            assigned.add(i);

            for (let j = i + 1; j < queries.length; j++) {
                if (!assigned.has(j) && similarityMatrix[i][j] >= threshold) {
                    cluster.push(j);
                    assigned.add(j);
                }
            }

            clusters.push(cluster);
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∞—Å—Ç–µ—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        state.clusters = clusters.map(clusterIndices => ({
            name: generateClusterName(clusterIndices.map(i => queries[i])),
            queries: clusterIndices.map(i => ({
                text: queries[i],
                originalIndex: i
            }))
        }));

        updateStats();
    }

    // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
    function clusterBySemantic(queries, sensitivity, useStemming, removeStopwords) {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        const categories = {
            '–∫—É–ø–∏—Ç—å|—Ü–µ–Ω–∞|—Å—Ç–æ–∏–º–æ—Å—Ç—å|–∑–∞–∫–∞–∑–∞—Ç—å|–ø—Ä–æ–¥–∞–∂–∞|–º–∞–≥–∞–∑–∏–Ω': '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã',
            '—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏|–æ–ø–∏—Å–∞–Ω–∏–µ|–ø–∞—Ä–∞–º–µ—Ç—Ä—ã|specs|—Ñ—É–Ω–∫—Ü–∏–∏': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã',
            '—Ä–µ–º–æ–Ω—Ç|–∑–∞–º–µ–Ω–∞|–ø–æ—á–∏–Ω–∫–∞|—Å–µ—Ä–≤–∏—Å|—Ü–µ–Ω—Ç—Ä|–º–∞—Å—Ç–µ—Ä': '–†–µ–º–æ–Ω—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
            '—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ|–æ—Ç–ª–∏—á–∏–µ|vs|versus|–∏–ª–∏|—á—Ç–æ –ª—É—á—à–µ': '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤',
            '–æ—Ç–∑—ã–≤—ã|–æ–±–∑–æ—Ä|–º–Ω–µ–Ω–∏–µ|—Ä–µ—Ü–µ–Ω–∑–∏—è': '–û—Ç–∑—ã–≤—ã –∏ –æ–±–∑–æ—Ä—ã'
        };

        const clustersMap = {};
        const otherQueries = [];
        
        queries.forEach((query, index) => {
            let matched = false;
            let lowerQuery = query.toLowerCase();
            
            if (useStemming) {
                lowerQuery = lowerQuery.split(/\s+/).map(word => stemWord(word)).join(' ');
            }
            
            if (removeStopwords) {
                lowerQuery = lowerQuery.split(/\s+/)
                    .filter(word => !russianStopwords.includes(word))
                    .join(' ');
            }
            
            for (const keywords in categories) {
                const regex = new RegExp(keywords);
                if (regex.test(lowerQuery)) {
                    const category = categories[keywords];
                    if (!clustersMap[category]) {
                        clustersMap[category] = [];
                    }
                    clustersMap[category].push({
                        text: query,
                        originalIndex: index
                    });
                    matched = true;
                    break;
                }
            }
            
            if (!matched) {
                otherQueries.push({
                    text: query,
                    originalIndex: index
                });
            }
        });

        // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª–∞—Å—Ç–µ—Ä—ã
        state.clusters = Object.keys(clustersMap).map(name => ({
            name,
            queries: clustersMap[name]
        }));

        // –ù–µ—Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
        if (otherQueries.length > 0) {
            state.clusters.push({
                name: '–î—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã',
                queries: otherQueries
            });
        }

        updateStats();
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –Ω–µ–º
    function generateClusterName(queries) {
        if (queries.length === 0) return '–ù–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä';
        
        // –ù–∞—Ö–æ–¥–∏–º –æ–±—â–∏–µ —Å–ª–æ–≤–∞ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
        const wordsCount = {};
        queries.forEach(query => {
            const words = query.toLowerCase().split(/\s+/);
            words.forEach(word => {
                if (word.length < 3 || russianStopwords.includes(word)) return;
                wordsCount[word] = (wordsCount[word] || 0) + 1;
            });
        });
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–ª–æ–≤–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ
        const commonWords = Object.keys(wordsCount)
            .filter(word => wordsCount[word] > 1)
            .sort((a, b) => wordsCount[b] - wordsCount[a]);
        
        return commonWords.length > 0 
            ? commonWords.slice(0, 3).join(' ') + '...' 
            : queries[0].split(/\s+/).slice(0, 3).join(' ') + '...';
    }

    // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å—Ç–µ–º–º–∏–Ω–≥ (–ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Å–ª–æ–≤–∞ –∫ –æ—Å–Ω–æ–≤–µ)
    function stemWord(word) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É Natural –¥–ª—è –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å—Ç–µ–º–º–∏–Ω–≥–∞
        return RussianStemmer.stemWord(word);
    }

    // ====================== –†–ï–ù–î–ï–†–ò–ù–ì –ò –ò–ù–¢–ï–†–§–ï–ô–° ======================

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    function renderClusters() {
        elements.clustersContainer.innerHTML = '';
        
        state.clusters.forEach((cluster, clusterIndex) => {
            const clusterElement = document.createElement('div');
            clusterElement.className = 'cluster';
            clusterElement.dataset.clusterIndex = clusterIndex;
            clusterElement.draggable = true;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
            clusterElement.addEventListener('dragstart', handleClusterDragStart);
            clusterElement.addEventListener('dragover', handleClusterDragOver);
            clusterElement.addEventListener('dragleave', handleClusterDragLeave);
            clusterElement.addEventListener('drop', handleClusterDrop);
            clusterElement.addEventListener('dragend', handleClusterDragEnd);
            
            const clusterHeader = document.createElement('div');
            clusterHeader.className = 'cluster-header';
            
            const titleElement = document.createElement('div');
            titleElement.className = 'cluster-title';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞
            const clusterNumber = document.createElement('span');
            clusterNumber.className = 'cluster-number';
            clusterNumber.textContent = clusterIndex + 1;
            titleElement.appendChild(clusterNumber);
            
            const titleText = document.createElement('span');
            titleText.textContent = cluster.name;
            titleText.contentEditable = true;
            titleText.addEventListener('blur', () => {
                renameCluster(clusterIndex, titleText.textContent);
            });
            titleElement.appendChild(titleText);
            
            const controlsElement = document.createElement('div');
            controlsElement.innerHTML = `
                <button onclick="renameCluster(${clusterIndex}, prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', '${cluster.name.replace(/'/g, "\\'")}'))">‚úèÔ∏è</button>
                <button onclick="deleteCluster(${clusterIndex})">üóëÔ∏è</button>
            `;
            
            clusterHeader.appendChild(titleElement);
            clusterHeader.appendChild(controlsElement);
            clusterElement.appendChild(clusterHeader);
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
            const queriesContainer = document.createElement('div');
            queriesContainer.className = 'queries-container';
            
            cluster.queries.forEach((query, queryIndex) => {
                const queryElement = document.createElement('div');
                queryElement.className = 'query-item';
                queryElement.draggable = true;
                queryElement.dataset.queryIndex = queryIndex;
                queryElement.dataset.originalIndex = query.originalIndex;
                queryElement.dataset.clusterIndex = clusterIndex;
                
                queryElement.innerHTML = `
                    <span><span class="drag-handle">‚ò∞</span> ${query.text}</span>
                    <div class="query-actions">
                        <button onclick="moveQueryToCluster(${clusterIndex}, ${queryIndex}, prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞:', ''))">‚û°Ô∏è</button>
                        <button onclick="removeQueryFromCluster(${clusterIndex}, ${queryIndex})">‚úñÔ∏è</button>
                    </div>
                `;
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ drag and drop
                queryElement.addEventListener('dragstart', handleDragStart);
                queryElement.addEventListener('dragend', handleDragEnd);
                queryElement.addEventListener('dragover', handleDragOver);
                queryElement.addEventListener('dragleave', handleDragLeave);
                queryElement.addEventListener('drop', handleDrop);
                
                queriesContainer.appendChild(queryElement);
            });
            
            clusterElement.appendChild(queriesContainer);
            elements.clustersContainer.appendChild(clusterElement);
        });
        
        updateStats();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStats() {
        const totalQueries = state.clusters.reduce((sum, cluster) => sum + cluster.queries.length, 0);
        elements.totalQueries.textContent = totalQueries;
        elements.totalClusters.textContent = state.clusters.length;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞
        updateExportPreview();
    }

    // ====================== –†–£–ß–ù–û–ï –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ö–õ–ê–°–¢–ï–†–û–í ======================

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
    function addNewCluster(name = null) {
        if (!name) {
            name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞:', '–ù–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä');
            if (!name) return;
        }
        
        saveStateToHistory();
        
        state.clusters.push({
            name: name,
            queries: []
        });
        
        renderClusters();
        addHistory(`–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä: "${name}"`);
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
    function deleteCluster(clusterIndex) {
        if (clusterIndex < 0 || clusterIndex >= state.clusters.length) return;
        
        saveStateToHistory();
        
        const deletedCluster = state.clusters[clusterIndex];
        state.clusters.splice(clusterIndex, 1);
        
        renderClusters();
        addHistory(`–£–¥–∞–ª–µ–Ω –∫–ª–∞—Å—Ç–µ—Ä: "${deletedCluster.name}"`);
    }

    // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
    function renameCluster(clusterIndex, newName) {
        if (!newName || clusterIndex < 0 || clusterIndex >= state.clusters.length) return;
        
        saveStateToHistory();
        
        const oldName = state.clusters[clusterIndex].name;
        state.clusters[clusterIndex].name = newName;
        
        renderClusters();
        addHistory(`–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –∫–ª–∞—Å—Ç–µ—Ä: "${oldName}" ‚Üí "${newName}"`);
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞
    function removeQueryFromCluster(clusterIndex, queryIndex) {
        if (clusterIndex < 0 || clusterIndex >= state.clusters.length) return;
        if (queryIndex < 0 || queryIndex >= state.clusters[clusterIndex].queries.length) return;
        
        saveStateToHistory();
        
        const removedQuery = state.clusters[clusterIndex].queries[queryIndex];
        state.clusters[clusterIndex].queries.splice(queryIndex, 1);
        
        // –ï—Å–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä –ø—É—Å—Ç–æ–π, —É–¥–∞–ª—è–µ–º –µ–≥–æ
        if (state.clusters[clusterIndex].queries.length === 0) {
            state.clusters.splice(clusterIndex, 1);
        }
        
        renderClusters();
        addHistory(`–£–¥–∞–ª–µ–Ω –∑–∞–ø—Ä–æ—Å: "${removedQuery.text}"`);
    }

    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–≥–æ–π –∫–ª–∞—Å—Ç–µ—Ä
    function moveQueryToCluster(fromClusterIndex, queryIndex, toClusterIndex) {
        if (isNaN(toClusterIndex) || toClusterIndex < 0 || toClusterIndex >= state.clusters.length) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞');
            return;
        }
        
        if (fromClusterIndex === toClusterIndex) return;
        
        saveStateToHistory();
        
        const query = state.clusters[fromClusterIndex].queries[queryIndex];
        
        // –£–¥–∞–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
        state.clusters[fromClusterIndex].queries.splice(queryIndex, 1);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ü–µ–ª–µ–≤–æ–π –∫–ª–∞—Å—Ç–µ—Ä
        state.clusters[toClusterIndex].queries.push(query);
        
        // –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä –ø—É—Å—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
        if (state.clusters[fromClusterIndex].queries.length === 0) {
            state.clusters.splice(fromClusterIndex, 1);
        }
        
        renderClusters();
        addHistory(`–ó–∞–ø—Ä–æ—Å "${query.text}" –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ –∫–ª–∞—Å—Ç–µ—Ä "${state.clusters[toClusterIndex >= state.clusters.length ? toClusterIndex - 1 : toClusterIndex].name}"`);
    }

    // –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    function mergeSelectedClusters() {
        let message = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä—ã –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è:\n';
        state.clusters.forEach((cluster, index) => {
            message += `${index + 1}. ${cluster.name} (${cluster.queries.length} –∑–∞–ø—Ä–æ—Å–æ–≤)\n`;
        });
        
        const indices = prompt(message + '\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):');
        if (!indices) return;
        
        const clusterIndices = indices.split(',')
            .map(i => parseInt(i.trim()) - 1)
            .filter(i => i >= 0 && i < state.clusters.length)
            .sort((a, b) => b - a); // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
            
        if (clusterIndices.length < 2) {
            alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã 2 –∫–ª–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è');
            return;
        }
        
        saveStateToHistory();
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
        const mergedQueries = [];
        const mergedNames = [];
        
        clusterIndices.forEach(i => {
            mergedQueries.push(...state.clusters[i].queries);
            mergedNames.push(state.clusters[i].name);
            state.clusters.splice(i, 1);
        });
        
        state.clusters.push({
            name: `–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π: ${mergedNames.join(' + ')}`,
            queries: mergedQueries
        });
        
        renderClusters();
        addHistory(`–û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –∫–ª–∞—Å—Ç–µ—Ä—ã: ${mergedNames.join(', ')}`);
    }

    // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
    function splitCluster() {
        let message = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:\n';
        state.clusters.forEach((cluster, index) => {
            message += `${index + 1}. ${cluster.name} (${cluster.queries.length} –∑–∞–ø—Ä–æ—Å–æ–≤)\n`;
        });
        
        const clusterIndex = prompt(message + '\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:') - 1;
        if (clusterIndex < 0 || clusterIndex >= state.clusters.length) return;
        
        const keywords = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):');
        if (!keywords) return;
        
        const keywordsList = keywords.split(',').map(k => k.trim().toLowerCase());
        
        saveStateToHistory();
        
        const cluster = state.clusters[clusterIndex];
        const matchedQueries = [];
        const unmatchedQueries = [];
        
        cluster.queries.forEach(query => {
            const lowerText = query.text.toLowerCase();
            if (keywordsList.some(kw => lowerText.includes(kw))) {
                matchedQueries.push(query);
            } else {
                unmatchedQueries.push(query);
            }
        });
        
        // –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
        state.clusters.splice(clusterIndex, 1);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä —Å —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
        if (matchedQueries.length > 0) {
            state.clusters.push({
                name: `${cluster.name} (${keywordsList.join(', ')})`,
                queries: matchedQueries
            });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Ç–µ—Ä —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∑–∞–ø—Ä–æ—Å–∞–º–∏
        if (unmatchedQueries.length > 0) {
            state.clusters.push({
                name: `${cluster.name} (–æ—Å—Ç–∞–ª—å–Ω—ã–µ)`,
                queries: unmatchedQueries
            });
        }
        
        renderClusters();
        addHistory(`–ö–ª–∞—Å—Ç–µ—Ä "${cluster.name}" —Ä–∞–∑–¥–µ–ª–µ–Ω –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º: ${keywordsList.join(', ')}`);
    }

    // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
    function recluster() {
        if (state.queries.length === 0) {
            alert('–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏');
            return;
        }
        
        saveStateToHistory();
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        const allQueries = [];
        state.clusters.forEach(cluster => {
            cluster.queries.forEach(query => {
                allQueries.push(query.text);
            });
        });
        
        state.queries = allQueries;
        processQueries();
        addHistory('–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è');
    }

    // ====================== DRAG AND DROP ======================

    function initDragAndDrop() {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–æ–Ω—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        elements.clusterPlaceholder.addEventListener('dragover', handleDragOver);
        elements.clusterPlaceholder.addEventListener('dragleave', handleDragLeave);
        elements.clusterPlaceholder.addEventListener('drop', handleDrop);
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–æ–Ω—ã –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        elements.clusterPlaceholderCluster.addEventListener('dragover', handleClusterDragOver);
        elements.clusterPlaceholderCluster.addEventListener('dragleave', handleClusterDragLeave);
        elements.clusterPlaceholderCluster.addEventListener('drop', handleClusterDrop);
    }

    let draggedItem = null;
    let draggedCluster = null;
    let draggedClusterIndex = -1;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
    function handleDragStart(e) {
        draggedItem = e.target.closest('.query-item');
        e.dataTransfer.setData('text/plain', '');
        setTimeout(() => {
            draggedItem.classList.add('dragging');
        }, 0);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
        elements.clusterPlaceholder.style.display = 'block';
    }

    function handleDragEnd() {
        if (draggedItem) {
            draggedItem.classList.remove('dragging');
            draggedItem = null;
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º placeholder
        elements.clusterPlaceholder.style.display = 'none';
        elements.clusterPlaceholderCluster.style.display = 'none';
    }

    function handleDragOver(e) {
        e.preventDefault();
        if (e.target.closest('.query-item') || e.target.closest('.cluster')) {
            e.target.closest('.query-item').style.borderLeft = '3px solid #2980b9';
        }
        elements.clusterPlaceholder.style.backgroundColor = '#e3f2fd';
    }

    function handleDragLeave(e) {
        if (e.target.closest('.query-item')) {
            e.target.closest('.query-item').style.borderLeft = '3px solid #3498db';
        }
        elements.clusterPlaceholder.style.backgroundColor = '#fafafa';
    }

    function handleDrop(e) {
        e.preventDefault();
        elements.clusterPlaceholder.style.backgroundColor = '#fafafa';
        
        if (!draggedItem) return;
        
        const fromClusterIndex = parseInt(draggedItem.dataset.clusterIndex);
        const queryIndex = parseInt(draggedItem.dataset.queryIndex);
        const originalIndex = parseInt(draggedItem.dataset.originalIndex);
        const queryText = state.clusters[fromClusterIndex].queries[queryIndex].text;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–ª–µ–≤–æ–π –∫–ª–∞—Å—Ç–µ—Ä
        let toClusterIndex = -1;
        const targetCluster = e.target.closest('.cluster');
        const targetQuery = e.target.closest('.query-item');
        
        if (targetCluster) {
            toClusterIndex = parseInt(targetCluster.dataset.clusterIndex);
        } else if (targetQuery) {
            toClusterIndex = parseInt(targetQuery.dataset.clusterIndex);
        } else if (e.target.id === 'cluster-placeholder') {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä
            saveStateToHistory();
            addNewCluster(`–ù–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä –¥–ª—è: ${queryText.split(/\s+/).slice(0, 3).join(' ')}...`);
            toClusterIndex = state.clusters.length - 1;
        } else {
            return;
        }
        
        if (fromClusterIndex === toClusterIndex) {
            // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
            const query = state.clusters[fromClusterIndex].queries[queryIndex];
            state.clusters[fromClusterIndex].queries.splice(queryIndex, 1);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
            let newPosition = state.clusters[toClusterIndex].queries.length;
            if (targetQuery) {
                const targetQueryIndex = parseInt(targetQuery.dataset.queryIndex);
                newPosition = targetQueryIndex;
                if (fromClusterIndex === toClusterIndex && queryIndex < targetQueryIndex) {
                    newPosition--;
                }
            }
            
            state.clusters[toClusterIndex].queries.splice(newPosition, 0, query);
            
            renderClusters();
            addHistory(`–ó–∞–ø—Ä–æ—Å "${query.text}" –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ "${state.clusters[toClusterIndex].name}"`);
        } else {
            // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
            saveStateToHistory();
            moveQueryToCluster(fromClusterIndex, queryIndex, toClusterIndex);
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    function handleClusterDragStart(e) {
        if (e.target.classList.contains('query-item') || e.target.classList.contains('query-actions')) return;
        
        draggedCluster = e.target.closest('.cluster');
        draggedClusterIndex = parseInt(draggedCluster.dataset.clusterIndex);
        e.dataTransfer.setData('text/plain', '');
        
        setTimeout(() => {
            draggedCluster.classList.add('dragging-cluster');
        }, 0);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        elements.clusterPlaceholderCluster.style.display = 'block';
    }

    function handleClusterDragOver(e) {
        e.preventDefault();
        elements.clusterPlaceholderCluster.style.backgroundColor = '#e3f2fd';
        
        const targetCluster = e.target.closest('.cluster');
        if (targetCluster && targetCluster !== draggedCluster) {
            targetCluster.style.border = '2px dashed #2980b9';
        }
    }

    function handleClusterDragLeave(e) {
        const targetCluster = e.target.closest('.cluster');
        if (targetCluster) {
            targetCluster.style.border = '1px solid #eee';
        }
        elements.clusterPlaceholderCluster.style.backgroundColor = '#e3f2fd';
    }

    function handleClusterDrop(e) {
        e.preventDefault();
        elements.clusterPlaceholderCluster.style.display = 'none';
        elements.clusterPlaceholderCluster.style.backgroundColor = '#e3f2fd';
        
        if (!draggedCluster) return;
        
        const targetCluster = e.target.closest('.cluster');
        let targetIndex = state.clusters.length;
        
        if (targetCluster) {
            targetIndex = parseInt(targetCluster.dataset.clusterIndex);
            targetCluster.style.border = '1px solid #eee';
        } else if (e.target.id === 'cluster-placeholder-cluster') {
            targetIndex = state.clusters.length;
        } else {
            return;
        }
        
        if (draggedClusterIndex === targetIndex) return;
        
        saveStateToHistory();
        
        // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä
        const movedCluster = state.clusters[draggedClusterIndex];
        state.clusters.splice(draggedClusterIndex, 1);
        
        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º targetIndex, –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º—ã–π –∫–ª–∞—Å—Ç–µ—Ä –±—ã–ª –ø–µ—Ä–µ–¥ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–µ–π
        if (draggedClusterIndex < targetIndex) {
            targetIndex--;
        }
        
        state.clusters.splice(targetIndex, 0, movedCluster);
        
        renderClusters();
        addHistory(`–ö–ª–∞—Å—Ç–µ—Ä "${movedCluster.name}" –ø–µ—Ä–µ–º–µ—â–µ–Ω –Ω–∞ –ø–æ–∑–∏—Ü–∏—é ${targetIndex + 1}`);
    }

    function handleClusterDragEnd() {
        if (draggedCluster) {
            draggedCluster.classList.remove('dragging-cluster');
            draggedCluster = null;
            draggedClusterIndex = -1;
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º placeholder
        elements.clusterPlaceholderCluster.style.display = 'none';
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –≤—Å–µ—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        document.querySelectorAll('.cluster').forEach(cluster => {
            cluster.style.border = '1px solid #eee';
        });
    }

    // ====================== –≠–ö–°–ü–û–†–¢ ======================

function exportTo(format) {
    let exportData = '';
    let mimeType = '';
    let fileExtension = '';
    
    if (format === 'csv') {
        exportData = generateCSV();
        mimeType = 'text/csv;charset=utf-8;';
        fileExtension = 'csv';
    } else if (format === 'json') {
        exportData = generateJSON();
        mimeType = 'application/json;charset=utf-8;';
        fileExtension = 'json';
    } else if (format === 'excel') {
        exportData = generateExcel();
        mimeType = 'application/vnd.ms-excel';
        fileExtension = 'xls';
    }
    
    // –°–æ–∑–¥–∞–µ–º BOM (Byte Order Mark) –¥–ª—è UTF-8
    const BOM = "\uFEFF";
    exportData = BOM + exportData;
    
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const blob = new Blob([exportData], { type: mimeType });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `seo-clusters-${new Date().toISOString().slice(0, 10)}.${fileExtension}`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(() => {
        URL.revokeObjectURL(url);
    }, 100);
    
    addHistory(`–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()}`);
}

function generateCSV() {
    let csv = '';
    
    state.clusters.forEach((cluster, index) => {
        // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
        csv += `"${cluster.name.toUpperCase().replace(/"/g, '""')}"\r\n`;
        
        // –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ (–∫–∞–∂–¥—ã–π –≤ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ)
        cluster.queries.forEach(query => {
            csv += `"${query.text.replace(/"/g, '""')}"\r\n`;
        });
        
        // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
        csv += '\r\n';
    });
    
    return csv;
}
function generateExcel() {
    const includeNames = document.getElementById('export-names').checked;
    const includeStats = document.getElementById('export-stats').checked;
    
    // –°–æ–∑–¥–∞–µ–º XML-—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è Excel
    let xml = '<?xml version="1.0"?>' +
        '<?mso-application progid="Excel.Sheet"?>' +
        '<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"' +
        ' xmlns:o="urn:schemas-microsoft-com:office:office"' +
        ' xmlns:x="urn:schemas-microsoft-com:office:excel"' +
        ' xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"' +
        ' xmlns:html="http://www.w3.org/TR/REC-html40">' +
        '<Styles>' +
        '<Style ss:ID="Header"><Font ss:Bold="1"/></Style>' +
        '<Style ss:ID="Title"><Font ss:Size="16" ss:Bold="1"/></Style>' +
        '</Styles>';
    
    // –°–æ–∑–¥–∞–µ–º –ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
    state.clusters.forEach((cluster, index) => {
        const sheetName = escapeSheetName(cluster.name);
        
        xml += `<Worksheet ss:Name="${sheetName}">` +
               '<Table>';
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
        xml += `<Row>` +
               `<Cell ss:StyleID="Title" ss:MergeAcross="1">` +
               `<Data ss:Type="String">${cluster.name}</Data>` +
               `</Cell>` +
               `</Row>`;
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
        if (includeStats) {
            xml += `<Row>` +
                   `<Cell ss:MergeAcross="1">` +
                   `<Data ss:Type="String">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: ${cluster.queries.length}</Data>` +
                   `</Cell>` +
                   `</Row>`;
        }
        
        // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
        xml += `<Row><Cell/><Cell/></Row>`;
        
        // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤
        xml += `<Row>` +
               `<Cell ss:StyleID="Header"><Data ss:Type="String">‚Ññ</Data></Cell>` +
               `<Cell ss:StyleID="Header"><Data ss:Type="String">–ó–∞–ø—Ä–æ—Å</Data></Cell>` +
               `</Row>`;
        
        // –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
        cluster.queries.forEach((query, queryIndex) => {
            xml += `<Row>` +
                   `<Cell><Data ss:Type="Number">${queryIndex + 1}</Data></Cell>` +
                   `<Cell><Data ss:Type="String">${escapeXml(query.text)}</Data></Cell>` +
                   `</Row>`;
        });
        
        xml += '</Table></Worksheet>';
    });
    
    xml += '</Workbook>';
    
    return xml;
}

function escapeSheetName(name) {
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞ (31 —Å–∏–º–≤–æ–ª –≤ Excel)
    let sheetName = name.substring(0, 31);
    // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
    sheetName = sheetName.replace(/[\\/?*[\]]/g, '');
    return sheetName || '–õ–∏—Å—Ç' + (index + 1);
}

function escapeXml(unsafe) {
    return unsafe.replace(/[<>&'"]/g, function(c) {
        switch (c) {
            case '<': return '&lt;';
            case '>': return '&gt;';
            case '&': return '&amp;';
            case '\'': return '&apos;';
            case '"': return '&quot;';
        }
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –ª–∏—Å—Ç–æ–≤
function escapeSheetName(name) {
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –Ω–∞–∑–≤–∞–Ω–∏—è (Excel –¥–æ–ø—É—Å–∫–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 31 —Å–∏–º–≤–æ–ª)
    let sheetName = name.substring(0, 31);
    
    // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
    sheetName = sheetName.replace(/[\\/?*[\]]/g, '');
    
    // –£–¥–∞–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ/–∫–æ–Ω–µ—á–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
    sheetName = sheetName.replace(/^'+|'+$/g, '');
    
    return sheetName || '–õ–∏—Å—Ç' + (index + 1);
}
function generateJSON() {
    const includeNames = document.getElementById('export-names').checked;
    const includeStats = document.getElementById('export-stats').checked;
    
    const result = {
        meta: {
            generatedAt: new Date().toISOString(),
            totalClusters: state.clusters.length,
            totalQueries: state.clusters.reduce((sum, c) => sum + c.queries.length, 0)
        },
        clusters: state.clusters.map((cluster, index) => {
            const clusterData = { number: index + 1 };
            if (includeNames) {
                clusterData.name = cluster.name;
            }
            if (includeStats) {
                clusterData.count = cluster.queries.length;
            }
            clusterData.queries = cluster.queries.map(q => q.text);
            return clusterData;
        })
    };
    
    return JSON.stringify(result, null, 2);
}

function updateExportPreview() {
    const exportPreview = document.getElementById('export-preview');
    exportPreview.value = generateCSV();
}
    // ====================== –ò–°–¢–û–†–ò–Ø –ò –°–û–•–†–ê–ù–ï–ù–ò–ï ======================

    function addHistory(message) {
        const now = new Date();
        const timeStr = now.toTimeString().substring(0, 8);
        const entry = document.createElement('p');
        entry.innerHTML = `<small>${timeStr} - ${message}</small>`;
        elements.operationsHistory.insertBefore(entry, elements.operationsHistory.firstChild);
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏
        if (elements.operationsHistory.children.length > 50) {
            elements.operationsHistory.removeChild(elements.operationsHistory.lastChild);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏–π
        state.history.push(JSON.stringify({
            queries: state.queries,
            clusters: state.clusters
        }));
        
        state.currentHistoryIndex = state.history.length - 1;
    }

    function saveStateToHistory() {
        state.history.push(JSON.stringify({
            queries: state.queries,
            clusters: JSON.parse(JSON.stringify(state.clusters)) // –ì–ª—É–±–æ–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
        }));
        
        state.currentHistoryIndex = state.history.length - 1;
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
        if (state.history.length > 20) {
            state.history.shift();
            state.currentHistoryIndex--;
        }
    }

    function undoLastAction() {
        if (state.currentHistoryIndex <= 0) {
            alert('–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç–º–µ–Ω—ã');
            return;
        }
        
        state.currentHistoryIndex--;
        const previousState = JSON.parse(state.history[state.currentHistoryIndex]);
        
        state.queries = previousState.queries;
        state.clusters = previousState.clusters;
        
        renderClusters();
        addHistory('–û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ');
    }

    function saveProject() {
        const projectData = {
            queries: state.queries,
            clusters: state.clusters,
            settings: {
                algorithm: elements.algorithm.value,
                sensitivity: elements.sensitivity.value,
                useStemming: elements.useStemming.checked,
                removeStopwords: elements.removeStopwords.checked
            }
        };
        
        const dataStr = JSON.stringify(projectData);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `seo-cluster-project-${new Date().toISOString().slice(0, 10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        addHistory('–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
    }

    function loadProject() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = e => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = event => {
                try {
                    const projectData = JSON.parse(event.target.result);
                    
                    state.queries = projectData.queries || [];
                    state.clusters = projectData.clusters || [];
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    if (projectData.settings) {
                        elements.algorithm.value = projectData.settings.algorithm || 'keywords';
                        elements.sensitivity.value = projectData.settings.sensitivity || 5;
                        elements.sensitivityValue.textContent = elements.sensitivity.value;
                        elements.useStemming.checked = !!projectData.settings.useStemming;
                        elements.removeStopwords.checked = !!projectData.settings.removeStopwords;
                    }
                    
                    renderClusters();
                    addHistory(`–ü—Ä–æ–µ–∫—Ç "${file.name}" –∑–∞–≥—Ä—É–∂–µ–Ω`);
                } catch (err) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ' + err.message);
                }
            };
            reader.readAsText(file);
        };
        
        input.click();
    }

// –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò)
// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
function moveByKeywords() {
    if (state.clusters.length === 0) {
        alert('–ù–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã');
        return;
    }

    // –®–∞–≥ 1: –í—ã–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    const keywordsInput = prompt(
        '–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é).\n' +
        '–ó–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –í–°–ï —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞:\n\n' +
        '–ü—Ä–∏–º–µ—Ä: –º–∞—á—Ç–∞, –∞–ª—é–º–∏–Ω–∏–µ–≤–∞—è\n\n' +
        'P.S. –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —É–∫–∞–∂–∏—Ç–µ "0" –≤ –Ω–æ–º–µ—Ä–µ –∫–ª–∞—Å—Ç–µ—Ä–∞',
        ''
    );
    if (!keywordsInput) return;

    // –®–∞–≥ 2: –í—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è (–ø–µ—Ä–µ–Ω–æ—Å –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ)
    const clusterNumber = prompt(
        `–í–≤–µ–¥–∏—Ç–µ:\n` +
        `‚Ä¢ –ù–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞ (1-${state.clusters.length}) –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞\n` +
        `‚Ä¢ –ò–ª–∏ "0" –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤\n\n` +
        `–¢–µ–∫—É—â–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã:\n${state.clusters.map((c, i) => `  ${i+1}. ${c.name}`).join('\n')}`,
        ''
    );
    if (clusterNumber === null) return;

    const isDeletionMode = clusterNumber === '0';
    let targetClusterIndex = parseInt(clusterNumber) - 1;

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
    if (!isDeletionMode && (isNaN(targetClusterIndex) || targetClusterIndex < 0 || targetClusterIndex >= state.clusters.length)) {
        alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞');
        return;
    }

    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    const keywords = keywordsInput.split(',')
        .map(word => word.trim().toLowerCase())
        .filter(word => word.length > 0);

    if (keywords.length === 0) {
        alert('–ù–µ —É–∫–∞–∑–∞–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞');
        return;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
    saveStateToHistory();
    let processedCount = 0;

    state.clusters.forEach((cluster, clusterIndex) => {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ü–µ–ª–µ–≤–æ–π –∫–ª–∞—Å—Ç–µ—Ä –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ
        if (!isDeletionMode && clusterIndex === targetClusterIndex) return;

        cluster.queries = cluster.queries.filter(query => {
            const queryText = query.text.toLowerCase();
            const isMatch = keywords.every(keyword => queryText.includes(keyword));

            if (isMatch) {
                processedCount++;
                // –ü–µ—Ä–µ–Ω–æ—Å –≤ —Ü–µ–ª–µ–≤–æ–π –∫–ª–∞—Å—Ç–µ—Ä –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ
                if (!isDeletionMode) {
                    state.clusters[targetClusterIndex].queries.push(query);
                }
                return false; // –£–¥–∞–ª—è–µ–º –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
            }
            return true; // –û—Å—Ç–∞–≤–ª—è–µ–º –≤ —Ç–µ–∫—É—â–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ
        });
    });

    // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã
    state.clusters = state.clusters.filter(cluster => cluster.queries.length > 0);

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    renderClusters();
    if (isDeletionMode) {
        addHistory(`–£–¥–∞–ª–µ–Ω–æ ${processedCount} –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∫–ª—é—á–∞–º: ${keywords.join(' + ')}`);
    } else {
        addHistory(`–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ ${processedCount} –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä "${state.clusters[targetClusterIndex].name}" –ø–æ –∫–ª—é—á–∞–º: ${keywords.join(' + ')}`);
    }
}    // ====================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ======================

    function loadSampleData() {
        elements.queriesInput.value = `–∫—É–ø–∏—Ç—å iPhone 15
—Ä–µ–º–æ–Ω—Ç iPhone –≤ –ú–æ—Å–∫–≤–µ
—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç iPhone 15 Pro Max
—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ iPhone 15
–∑–∞–º–µ–Ω–∞ —ç–∫—Ä–∞–Ω–∞ iPhone 14
—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ iPhone 15 –∏ Samsung S23
–ª—É—á—à–∏–µ —á–µ—Ö–ª—ã –¥–ª—è iPhone 15
–æ—Ç–∑—ã–≤—ã –æ iPhone 15
–≥–¥–µ –∫—É–ø–∏—Ç—å iPhone –¥–µ—à–µ–≤–æ
–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω Apple
iPhone 15 –æ–±–∑–æ—Ä
—Ü–µ–Ω–∞ iPhone 15 –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö
—Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä Apple –ú–æ—Å–∫–≤–∞
–∫–∞–∫–æ–π iPhone –ª—É—á—à–µ –∫—É–ø–∏—Ç—å
–ø—Ä–æ–¥–∞–∂–∞ iPhone –±/—É
iPhone 15 vs Xiaomi 13
–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –¥–ª—è iPhone 15
–≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ iPhone
–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö iPhone
–∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å iPhone`;
        
        addHistory('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤');
    }

    function clearInput() {
        elements.queriesInput.value = '';
        addHistory('–û—á–∏—â–µ–Ω–æ –ø–æ–ª–µ –≤–≤–æ–¥–∞');
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = init;
    </script>